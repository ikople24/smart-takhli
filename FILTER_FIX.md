# การแก้ไขปัญหาการกรองข้อมูล

## ปัญหาที่พบ
การกรองข้อมูลในหน้า "ดำเนินการเสร็จสิ้น" ทำงานผิด เช่น:
- เมื่อเลือก "เกิน 15 วัน" แต่ยังแสดงรายการที่เสร็จใน "2 วัน" และ "ภายใน 7 วัน"
- การกรองไม่ตรงตามช่วงเวลาที่เลือก
- การแสดงผลใน CardCompleted ไม่ตรงกับการกรอง (เช่น แสดง "7 วัน" แต่ถูกกรองใน "ภายใน 24 ชม.")

## สาเหตุของปัญหา
1. **การคำนวณระยะเวลาผิด**: ไม่ได้ใช้ `Math.floor()` ทำให้ได้ค่าทศนิยม
2. **การเปรียบเทียบไม่ถูกต้อง**: เงื่อนไขการกรองไม่ตรงกับช่วงเวลาที่กำหนด
3. **การคำนวณไม่สอดคล้องกัน**: CardCompleted component ใช้การคำนวณต่างจากหน้า status

## การแก้ไข

### 1. แก้ไขการคำนวณระยะเวลาในหน้า status
```javascript
// ก่อน (ผิด)
const processingTimeHours = (completionDate - startDate) / (1000 * 60 * 60);

// หลัง (ถูก)
const processingTimeHours = Math.floor((completionDate - startDate) / (1000 * 60 * 60));
```

### 2. แก้ไขการคำนวณระยะเวลาใน CardCompleted component
```javascript
// ก่อน (ผิด)
const diffMs = endDate - startDate;
const diffHours = Math.floor(diffMs / (1000 * 60 * 60));

// หลัง (ถูก)
const processingTimeHours = Math.floor((endDate - startDate) / (1000 * 60 * 60));
```

### 3. ตรวจสอบเงื่อนไขการกรอง
```javascript
const timeFilters = {
  '24h': 24,      // ≤ 24 ชั่วโมง
  '2d': 48,       // ≤ 48 ชั่วโมง (2 วัน)
  '3d': 72,       // ≤ 72 ชั่วโมง (3 วัน)
  '7d': 168,      // ≤ 168 ชั่วโมง (7 วัน)
  '15d': 360,     // ≤ 360 ชั่วโมง (15 วัน)
  'over15d': 361, // > 360 ชั่วโมง (เกิน 15 วัน)
};
```

### 4. เงื่อนไขการกรอง
```javascript
if (selectedTimeFilter === 'over15d') {
  return processingTimeHours > 360; // เกิน 15 วัน
} else {
  return processingTimeHours <= hoursLimit; // ไม่เกินช่วงเวลาที่กำหนด
}
```

## ผลลัพธ์ที่คาดหวัง

### เมื่อเลือก "ภายใน 24 ชม."
- แสดงเฉพาะรายการที่ใช้เวลา ≤ 24 ชั่วโมง
- สีแท็ก: เขียว
- ข้อความ: "ภายใน 24 ชม. (X ชั่วโมง)"

### เมื่อเลือก "2 วัน"
- แสดงเฉพาะรายการที่ใช้เวลา ≤ 48 ชั่วโมง
- สีแท็ก: น้ำเงิน
- ข้อความ: "2 วัน (X วัน)"

### เมื่อเลือก "3 วัน"
- แสดงเฉพาะรายการที่ใช้เวลา ≤ 72 ชั่วโมง
- สีแท็ก: ม่วง
- ข้อความ: "3 วัน (X วัน)"

### เมื่อเลือก "ภายใน 7 วัน"
- แสดงเฉพาะรายการที่ใช้เวลา ≤ 168 ชั่วโมง
- สีแท็ก: เหลือง
- ข้อความ: "ภายใน 7 วัน (X วัน)"

### เมื่อเลือก "ภายใน 15 วัน"
- แสดงเฉพาะรายการที่ใช้เวลา ≤ 360 ชั่วโมง
- สีแท็ก: ส้ม
- ข้อความ: "ภายใน 15 วัน (X วัน)"

### เมื่อเลือก "เกิน 15 วัน"
- แสดงเฉพาะรายการที่ใช้เวลา > 360 ชั่วโมง
- สีแท็ก: แดง
- ข้อความ: "เกิน 15 วัน (X วัน)"

## การทดสอบ
1. เปิดหน้า "ดำเนินการเสร็จสิ้น"
2. เลือกฟิลเตอร์ต่างๆ
3. ตรวจสอบว่ารายการที่แสดงตรงตามช่วงเวลาที่เลือก
4. ตรวจสอบสีของแท็กเวลาตรงตามช่วงเวลา
5. ตรวจสอบข้อความในแท็กเวลาตรงกับการกรอง

## ไฟล์ที่แก้ไข
- `pages/status/index.jsx` - แก้ไขการคำนวณระยะเวลาและการกรอง
- `components/CardCompleted.js` - แก้ไขการคำนวณระยะเวลาให้ตรงกับหน้า status 