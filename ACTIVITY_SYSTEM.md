# ระบบจัดการกิจกรรม (Activity Management System)

## ภาพรวม

ระบบจัดการกิจกรรมถูกออกแบบมาเพื่อให้สามารถแยกความคิดเห็นตามกิจกรรมต่างๆ ได้ โดยเมื่อกิจกรรมหนึ่งจบแล้ว สามารถเก็บข้อมูลแยกกัน และในอนาคตสามารถเปิดกิจกรรมใหม่ได้โดยไม่ปนกัน

## คุณสมบัติหลัก

### 1. การจัดการกิจกรรม
- **สร้างกิจกรรมใหม่**: สามารถสร้างกิจกรรมใหม่พร้อมกำหนดชื่อ, รายละเอียด, วันที่เริ่ม-สิ้นสุด
- **แก้ไขกิจกรรม**: ปรับปรุงข้อมูลกิจกรรมที่มีอยู่
- **ลบกิจกรรม**: ลบกิจกรรมที่ไม่ต้องการ
- **เปิด/ปิดกิจกรรม**: ควบคุมการแสดงผลกิจกรรม
- **ตั้งกิจกรรมเริ่มต้น**: กำหนดกิจกรรมที่จะแสดงเป็นค่าเริ่มต้น

### 2. การแยกความคิดเห็นตามกิจกรรม
- **เลือกกิจกรรม**: ผู้ใช้สามารถเลือกกิจกรรมที่ต้องการแสดงความคิดเห็น
- **กรองข้อมูล**: แสดงเฉพาะความคิดเห็นของกิจกรรมที่เลือก
- **สถิติแยกตามกิจกรรม**: คำนวณสถิติเฉพาะกิจกรรมที่เลือก

## โครงสร้างฐานข้อมูล

### Activity Model
```javascript
{
  name: String,           // ชื่อกิจกรรม
  description: String,    // รายละเอียด
  startDate: Date,        // วันที่เริ่ม
  endDate: Date,          // วันที่สิ้นสุด
  isActive: Boolean,      // สถานะการใช้งาน
  isDefault: Boolean,     // เป็นกิจกรรมเริ่มต้น
  createdAt: Date,        // วันที่สร้าง
  updatedAt: Date         // วันที่อัปเดต
}
```

### StudentFeedback Model (อัปเดต)
```javascript
{
  activityId: ObjectId,   // รอฟอเรนซ์ไปยัง Activity
  grade: String,          // ระดับการศึกษา
  comment: String,        // ความคิดเห็น
  emotionLevel: Number,   // ระดับความพึงพอใจ
  category: String,       // หมวดหมู่
  // ... ฟิลด์อื่นๆ
}
```

## API Endpoints

### กิจกรรม
- `GET /api/activities` - ดึงรายการกิจกรรม
- `POST /api/activities` - สร้างกิจกรรมใหม่
- `GET /api/activities/[id]` - ดึงข้อมูลกิจกรรม
- `PUT /api/activities/[id]` - อัปเดตกิจกรรม
- `DELETE /api/activities/[id]` - ลบกิจกรรม

### ความคิดเห็น (อัปเดต)
- `GET /api/student-feedback?activityId=[id]` - ดึงความคิดเห็นตามกิจกรรม
- `POST /api/student-feedback` - ส่งความคิดเห็น (ต้องมี activityId)

## การใช้งาน

### 1. สำหรับผู้ดูแลระบบ

#### เข้าสู่หน้าจัดการกิจกรรม
```
/admin/manage-activities
```

#### สร้างกิจกรรมใหม่
1. คลิกปุ่ม "+ สร้างกิจกรรมใหม่"
2. กรอกข้อมูล:
   - ชื่อกิจกรรม
   - รายละเอียด
   - วันที่เริ่ม-สิ้นสุด
   - เลือกเป็นกิจกรรมเริ่มต้น (ถ้าต้องการ)
3. คลิก "สร้าง"

#### จัดการกิจกรรม
- **แก้ไข**: คลิกปุ่ม "แก้ไข" ในแถวของกิจกรรม
- **เปิด/ปิด**: คลิกปุ่ม "เปิด" หรือ "ปิด" เพื่อเปลี่ยนสถานะ
- **ลบ**: คลิกปุ่ม "ลบ" และยืนยันการลบ

### 2. สำหรับผู้ใช้ทั่วไป

#### เลือกกิจกรรม
1. ในหน้าแสดงความคิดเห็น จะมี dropdown สำหรับเลือกกิจกรรม
2. เลือกกิจกรรมที่ต้องการ
3. ระบบจะแสดงสถิติและความคิดเห็นเฉพาะกิจกรรมนั้น

#### ส่งความคิดเห็น
1. คลิกปุ่ม "เขียนความคิดเห็น"
2. เลือกกิจกรรม (ถ้ายังไม่ได้เลือก)
3. กรอกข้อมูลความคิดเห็น
4. ส่งความคิดเห็น

## การติดตั้งและตั้งค่า

### 1. สร้างกิจกรรมเริ่มต้น
```bash
npm run create-default-activity
```

### 2. เข้าสู่หน้าจัดการกิจกรรม
```
/admin/manage-activities
```

### 3. สร้างกิจกรรมใหม่
- กำหนดชื่อและรายละเอียด
- ตั้งวันที่เริ่ม-สิ้นสุด
- เลือกเป็นกิจกรรมเริ่มต้น (ถ้าต้องการ)

## การอัปเกรดจากระบบเดิม

### 1. ข้อมูลเดิม
หากมีข้อมูลความคิดเห็นเดิมในระบบ จะต้อง:
1. สร้างกิจกรรมเริ่มต้น
2. อัปเดตข้อมูลความคิดเห็นเดิมให้มี activityId

### 2. Migration Script
```javascript
// ตัวอย่าง script สำหรับอัปเดตข้อมูลเดิม
const defaultActivity = await Activity.findOne({ isDefault: true });
if (defaultActivity) {
  await StudentFeedback.updateMany(
    { activityId: { $exists: false } },
    { activityId: defaultActivity._id }
  );
}
```

## ข้อควรระวัง

1. **การลบกิจกรรม**: เมื่อลบกิจกรรม ข้อมูลความคิดเห็นที่เกี่ยวข้องจะยังคงอยู่ แต่จะไม่สามารถเข้าถึงได้
2. **กิจกรรมเริ่มต้น**: ควรมีกิจกรรมเริ่มต้นอย่างน้อย 1 กิจกรรม
3. **วันที่กิจกรรม**: ควรตั้งวันที่ให้ครอบคลุมช่วงเวลาที่ต้องการรับความคิดเห็น

## การพัฒนาต่อ

### ฟีเจอร์ที่อาจเพิ่มในอนาคต
1. **การส่งออกข้อมูล**: ส่งออกความคิดเห็นตามกิจกรรมเป็น CSV/Excel
2. **การวิเคราะห์**: แสดงกราฟและสถิติเปรียบเทียบระหว่างกิจกรรม
3. **การแจ้งเตือน**: แจ้งเตือนเมื่อกิจกรรมใกล้สิ้นสุด
4. **การจัดการสิทธิ์**: กำหนดสิทธิ์การเข้าถึงกิจกรรมต่างๆ
